{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "jarvis.general-agent.protocol.schema.json",
  "title": "General Agent Service Protocol",
  "type": "object",
  "$defs": {
    "MessagePart": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": { "type": "string", "enum": ["text"] },
        "text": { "type": "string" }
      }
    },
    "ChatMessage": {
      "type": "object",
      "additionalProperties": false,
      "required": ["parts"],
      "properties": {
        "parts": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/MessagePart" }
        }
      }
    },
    "CreateSessionRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": ["jarvis_session_id"],
      "properties": {
        "jarvis_session_id": { "type": "string", "minLength": 1 },
        "preferred_session_id": { "type": "string" }
      }
    },
    "CreateSessionResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["general_session_id"],
      "properties": {
        "general_session_id": { "type": "string", "minLength": 1 }
      }
    },
    "ChatRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": ["general_session_id", "mode", "message", "stream"],
      "properties": {
        "general_session_id": { "type": "string", "minLength": 1 },
        "mode": { "type": "string", "enum": ["general"] },
        "message": { "$ref": "#/$defs/ChatMessage" },
        "stream": { "type": "boolean" }
      }
    },
    "ChatResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["assistant"],
      "properties": {
        "assistant": { "$ref": "#/$defs/ChatMessage" }
      }
    },
    "HealthResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["healthy", "version", "uptime_ms"],
      "properties": {
        "healthy": { "type": "boolean" },
        "version": { "type": "string" },
        "uptime_ms": { "type": "integer", "minimum": 0 }
      }
    },

    "ToolCall": { "$ref": "jarvis.tool-boundary.schema.json#/$defs/ToolCall" },
    "ToolResult": { "$ref": "jarvis.tool-boundary.schema.json#/$defs/ToolResult" },

    "PostToolResultRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": ["general_session_id", "tool_result"],
      "properties": {
        "general_session_id": { "type": "string", "minLength": 1 },
        "tool_result": { "$ref": "#/$defs/ToolResult" }
      }
    },
    "PostToolResultResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["accepted"],
      "properties": {
        "accepted": { "type": "boolean" }
      }
    },

    "MemoryWriteRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": ["general_session_id", "target", "content"],
      "properties": {
        "general_session_id": { "type": "string", "minLength": 1 },
        "content": { "type": "string" },
        "target": { "type": "string", "enum": ["long_term", "daily"] }
      }
    },
    "MemoryWriteResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["path"],
      "properties": {
        "path": { "type": "string", "minLength": 1 }
      }
    },
    "MemorySearchResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": ["results"],
      "properties": {
        "results": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["path", "excerpt"],
            "properties": {
              "path": { "type": "string" },
              "excerpt": { "type": "string" },
              "line_start": { "type": "integer", "minimum": 1 },
              "line_end": { "type": "integer", "minimum": 1 },
              "score": { "type": "number" }
            }
          }
        }
      }
    },

    "SseAssistantDelta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["text"],
      "properties": { "text": { "type": "string" } }
    },
    "SseAssistantFinal": {
      "type": "object",
      "additionalProperties": false,
      "required": ["text"],
      "properties": { "text": { "type": "string" } }
    },
    "SseToolRequest": { "$ref": "#/$defs/ToolCall" },
    "SseToolResult": { "$ref": "#/$defs/ToolResult" },
    "SseError": {
      "type": "object",
      "additionalProperties": false,
      "required": ["code", "message"],
      "properties": {
        "code": { "type": "string" },
        "message": { "type": "string" },
        "details": {}
      }
    }
  },
  "properties": {
    "HealthResponse": { "$ref": "#/$defs/HealthResponse" },
    "CreateSessionRequest": { "$ref": "#/$defs/CreateSessionRequest" },
    "CreateSessionResponse": { "$ref": "#/$defs/CreateSessionResponse" },
    "ChatRequest": { "$ref": "#/$defs/ChatRequest" },
    "ChatResponse": { "$ref": "#/$defs/ChatResponse" },
    "PostToolResultRequest": { "$ref": "#/$defs/PostToolResultRequest" },
    "PostToolResultResponse": { "$ref": "#/$defs/PostToolResultResponse" },

    "MemoryWriteRequest": { "$ref": "#/$defs/MemoryWriteRequest" },
    "MemoryWriteResponse": { "$ref": "#/$defs/MemoryWriteResponse" },
    "MemorySearchResponse": { "$ref": "#/$defs/MemorySearchResponse" },

    "SseAssistantDelta": { "$ref": "#/$defs/SseAssistantDelta" },
    "SseAssistantFinal": { "$ref": "#/$defs/SseAssistantFinal" },
    "SseToolRequest": { "$ref": "#/$defs/SseToolRequest" },
    "SseToolResult": { "$ref": "#/$defs/SseToolResult" },
    "SseError": { "$ref": "#/$defs/SseError" }
  }
}
